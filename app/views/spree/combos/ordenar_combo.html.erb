<h1> Ordenar Combo <%= @combo.name %> </h1>

<p>  </p>
<%= form_tag populate_combos_orders_path do %>
	  <%= hidden_field_tag :"combo_id", @combo.id %>
	  <p style="font-style: italic; font-size: 0.9em;"> Por favor, en caso de haber comprado previamente el combo por MercadoLibre, ingrese su usuario e id de compra </p>
		<%= text_field_tag :"ml_user", nil, class: 'form-control ', style:"width:150px; height: 2em; ", placeholder: "Usuario ML" %>
		<br>
		<%= text_field_tag :"ml_purchase_id", nil, class: 'form-control ', style:"width:150px; height: 2em; ",placeholder: "Id de compra ML" %>	
		<br>
 		<p style="font-style: italic; font-size: 0.9em;"> Productos del combo:  </p> 
	  <% @combo.combo_lines.each do |cl| %>
			<% cl.taxon.products.each do |p| %>
			<% if p.has_variants? %>
	    	  <div id="accordion-<%= p.id %>">
	    	    <a class="list-group-item" data-toggle="collapse" data-parent="accordion-<%= p.id %>" href="#<%= p.id %>" style="padding:0 ; border:0;">
	    	<% end %>
		        <%= image_tag(p.images.first.attachment.url(:mini), class: "thumbnail", style: "margin-bottom: 0px; display:inline-block;") %> 
		    	<%= p.name %>
			<% if !p.has_variants? %>
			  	<%= number_field_tag :"quantity_#{p.master.id}", 1, class: 'form-control ', value: 0,  min: 0,
					    style:"width:50px; display:inline-block; height: 2em; " %><br>
			<% else %>
				- Despliegue la lista para elegir las variantes deseadas.
			<% end %>
			<% if p.has_variants? %>
			    </a>
			<% end %>
		    <% if p.has_variants? %>
		      <div class="row" style="margin: 0;">
		        <br>
		        <div id="<%= p.id %>" class="list-group panel-collapse accordion-body collapse">
				    <div class="select-variant-panel">
					  <p> Seleccionar variante y cantidades para <b><%= p.name %></b> (Deben sumar <b><%= cl.quantity %></b>) </p>
					  <table>
					    <% p.variants_and_option_values(current_currency).each_with_index do |variant, index| %>
						    <% if variant.can_supply?  %> 
						      <tr>
								  <% i = p.variant_images.find_by(viewable_id: variant.id) # Busco la foto de la variant %>
								  <td class="cellComboChoose">  
								    <% if i != nil              # Si no hay foto para la variant uso la primer imagen del producto %>
							          <%= image_tag(i.attachment.url(:mini), class: "thumbnail", style: "margin-bottom: 1px;") %> 
								    <% else %>
							     	  <%= image_tag(p.images.first.attachment.url(:mini), class: "thumbnail", style: "margin-bottom: 0px;") %> 
								    <% end %>
							      </td>
							      <td class="cellComboChoose"><p style="margin:0px; line-height:2em; "><b><%=variant_options variant%></b></p></td>
						    	  <td class="cellComboChoose"><%= number_field_tag :"quantity_#{variant.id}", 0, class: 'form-control', min: 0,
									    style:"width:50px; display:inline-block; height: 2em;" %></td>
							  </tr>
							<% end %>
					    <% end %>
					  </table>
				    </div>
				  </div>
				</div>
			  </div>	         
	     	<% end %>
		  <% end %>
		 <% end %>
		 <br>
	 <br>
	  <%= submit_tag "Ordenar!" , class: "btn btn-success" %>
<% end %>  
